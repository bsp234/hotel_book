<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GABON HOTEL - Edit Room</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div class="admin-container">
        <aside class="sidebar">
            <div class="sidebar-logo">
                <h2>GABON</h2>
                <span>HOTEL</span>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item" onclick="window.location.href='dashboard.html'"><i class="fa-solid fa-shapes"></i> <span>Dashboard</span></div>
                <div class="menu-category">Rooms</div>
                <div class="menu-item active" onclick="window.location.href='rooms-list.html'"><i class="fa-solid fa-bed"></i> <span>Rooms</span></div>
                <div class="menu-category">Bookings</div>
                <div class="menu-item" onclick="window.location.href='bookings-list.html'"><i class="fa-solid fa-calendar-check"></i> <span>View Bookings</span></div>
            </div>
        </aside>

        <main class="admin-content">
            <div class="admin-header">
                <h2 id="form-title">Add New Room</h2>
            </div>

            <div class="admin-table-container" style="padding: 20px;">
                <form id="roomForm">
                    <input type="hidden" id="roomId">

                    <div style="margin-bottom: 15px;">
                        <label style="display:block; margin-bottom:5px;">Room Number</label>
                        <input type="text" id="room_number" required style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display:block; margin-bottom:5px;">Room Type</label>
                        <select id="room_type" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;">
                            <option value="Single">Single</option>
                            <option value="Double">Double</option>
                            <option value="Deluxe">Deluxe</option>
                            <option value="Suite">Suite</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display:block; margin-bottom:5px;">Base Price ($)</label>
                        <input type="number" id="base_price" step="0.01" required style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;">
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display:block; margin-bottom:5px;">Status</label>
                        <select id="status" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;">
                            <option value="Available">Available</option>
                            <option value="Occupied">Occupied</option>
                            <option value="Maintenance">Maintenance</option>
                        </select>
                    </div>

                    <div style="margin-top: 20px;">
                        <button type="submit" id="saveBtn" class="btn" style="background-color: #7b946f; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 4px;">Save Room</button>
                        <button type="button" onclick="window.location.href='rooms-list.html'" style="background-color: #ccc; padding: 10px 20px; border: none; cursor: pointer; border-radius: 4px; margin-left: 10px;">Cancel</button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script>
        // 1. Check for ID in URL to populate form (Edit Mode)
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            if (id) {
                fetchRoomData(`api/rooms/get?id=${id}`);
            }
        });

        // 2. Fetch Helper
        function fetchRoomData(url) {
            fetch(url)
                .then(res => {
                    if (!res.ok) throw new Error("Room not found");
                    return res.json();
                })
                .then(room => {
                    document.getElementById('roomId').value = room.id;
                    document.getElementById('room_number').value = room.room_number;
                    document.getElementById('room_type').value = room.room_type;
                    document.getElementById('base_price').value = room.base_price;
                    document.getElementById('status').value = room.status;

                    // Update UI to indicate Edit mode
                    document.getElementById('form-title').innerText = "Edit Room: " + room.room_number;
                    document.getElementById('saveBtn').innerText = "Update Room";
                })
                .catch(err => {
                    console.error(err);
                    alert("Error loading room data.");
                });
        }

        // 3. Save Logic (Create or Update)
        document.getElementById('roomForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const id = document.getElementById('roomId').value;
            const roomData = {
                // If id is empty, it's a new room (null), otherwise it's an update
                id: id ? parseInt(id) : null,
                room_number: document.getElementById('room_number').value,
                room_type: document.getElementById('room_type').value,
                base_price: parseFloat(document.getElementById('base_price').value),
                status: document.getElementById('status').value
            };

            const endpoint = id ? 'api/rooms/update' : 'api/rooms/create';

            fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(roomData)
            })
            .then(res => {
                if (res.ok) {
                    alert("Room saved successfully!");
                    window.location.href = 'rooms-list.html';
                } else {
                    alert("Error saving room.");
                }
            })
            .catch(err => console.error("Error:", err));
        });
    </script>
</body>
</html>